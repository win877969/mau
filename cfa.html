<!DOCTYPE html>
<html>
<head>
    <title>Cek Status Proxy</title>
</head>
<body>
    <table id="proxy-table">
        <thead>
            <tr>
                <th>Proxy</th>
                <th>Status</th>
                <th>Latency (ms)</th>
            </tr>
        </thead>
        <tbody id="proxy-list"></tbody>
    </table>

    <script>
        fetch('bot/proxy_list.txt')
            .then(response => response.text())
            .then(data => {
                const proxyList = data.split('\n');
                const proxyTableBody = document.getElementById('proxy-list');

                proxyList.forEach(proxy => {
                    const row = document.createElement('tr');
                    const proxyCell = document.createElement('td');
                    const statusCell = document.createElement('td');
                    const latencyCell = document.createElement('td');
                    const statusButton = document.createElement('button');

                    proxyCell.textContent = proxy;
                    statusButton.textContent = 'Cek Status';
                    statusButton.onclick = () => {
                        checkProxyStatus(proxy, statusButton, latencyCell);
                    };
                    statusCell.appendChild(statusButton);

                    row.appendChild(proxyCell);
                    row.appendChild(statusCell);
                    row.appendChild(latencyCell);
                    proxyTableBody.appendChild(row);
                });
            });

        function checkProxyStatus(proxy, statusButton, latencyCell) {
            if (!proxy) {
                statusButton.textContent = 'Proxy tidak valid';
                return;
            }

            statusButton.textContent = 'Mengirim permintaan...';

            const startTime = performance.now();
            fetch('https://httpbin.org/ip', {
                proxy: `http://${proxy}`,
                timeout: 5000 // Timeout 5 detik
            })
            .then(response => {
                if (!response.ok) {
                    statusButton.textContent = 'Tidak Aktif';
                    return;
                }
                return response.json();
            })
            .then(data => {
                const endTime = performance.now();
                const latency = endTime - startTime;
                statusButton.textContent = 'Aktif';
                latencyCell.textContent = `${latency.toFixed(2)} ms`;
            })
            .catch(error => {
                statusButton.textContent = 'Error';
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
