<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy Counter with Country Name</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .table-container {
            width: 45%;
        }
        .details-container {
            width: 45%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        #details h2 {
            text-transform: capitalize;
        }
        #details ul {
            list-style-type: none;
            padding: 0;
        }
        #details li {
            margin: 5px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Proxy Counter with Country Name</h1>
    <p>Jumlah proxy berdasarkan kode negara dari file <strong>proxy_list.txt</strong>:</p>
    <div class="container">
        <!-- Tabel Negara -->
        <div class="table-container">
            <h2>Daftar Negara dan Jumlah Proxy</h2>
            <table id="resultTable" style="display:none;">
                <thead>
                    <tr>
                        <th>Kode Negara</th>
                        <th>Total Proxy</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Detail Proxy -->
        <div class="details-container" id="details" style="display:none;">
            <h2 id="countryName"></h2>
            <p><strong>IP:Port</strong></p>
            <ul id="proxyList"></ul>
        </div>
    </div>

    <script>
        // Fungsi untuk membaca file proxy_list.txt
        async function fetchProxies() {
            try {
                // Meminta file proxy_list.txt
                const response = await fetch('proxy_list.txt');
                if (!response.ok) {
                    throw new Error('Gagal memuat file proxy_list.txt');
                }

                // Membaca isi file
                const proxyData = await response.text();

                // Memproses data
                const lines = proxyData.trim().split('\n');
                const countryProxies = {};
                const countryCount = {};

                // Mapping kode negara ke nama negara
                const countryNames = {
                    id: 'Indonesia',
                    kr: 'Korea',
                    sg: 'Singapore',
                    us: 'United States',
                    jp: 'Japan',
                };

                lines.forEach(line => {
                    const parts = line.trim().split(',');
                    if (parts.length >= 3) {
                        const country = parts[2].toLowerCase();
                        const ipPort = `${parts[0]}:${parts[1]}`;

                        if (!countryProxies[country]) {
                            countryProxies[country] = [];
                        }
                        countryProxies[country].push(ipPort);
                        countryCount[country] = (countryCount[country] || 0) + 1;
                    }
                });

                // Menampilkan hasil di tabel
                const table = document.getElementById('resultTable');
                const tbody = table.querySelector('tbody');

                for (const [country, count] of Object.entries(countryCount)) {
                    const countryName = countryNames[country] || country.toUpperCase(); // Menampilkan kode negara jika tidak ada di daftar
                    const row = document.createElement('tr');
                    row.innerHTML = `<td><a href="#" onclick="showDetails('${country}')">${countryName}</a></td><td>${count}</td>`;
                    tbody.appendChild(row);
                }

                table.style.display = 'table'; // Menampilkan tabel

                // Fungsi untuk menampilkan detail proxy
                window.showDetails = function (country) {
                    const detailsDiv = document.getElementById('details');
                    const countryName = document.getElementById('countryName');
                    const proxyList = document.getElementById('proxyList');

                    // Menampilkan nama negara sesuai dengan kode negara atau kode negara jika tidak ada
                    countryName.textContent = countryNames[country] || country.toUpperCase();

                    proxyList.innerHTML = '';

                    (countryProxies[country] || []).forEach(ipPort => {
                        const listItem = document.createElement('li');
                        listItem.textContent = ipPort;
                        proxyList.appendChild(listItem);
                    });

                    detailsDiv.style.display = 'block';
                };
            } catch (error) {
                console.error(error);
                alert('Gagal memproses data: ' + error.message);
            }
        }

        // Panggil fungsi saat halaman dimuat
        fetchProxies();
    </script>
</body>
</html>
