<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy Counter with Country Name</title>
    <style>
        /* Style remains the same */
    </style>
</head>
<body>
    <h1>Proxy Counter with Country Name</h1>
    <p>Jumlah proxy berdasarkan kode negara dari file <strong>proxy_list.txt</strong>:</p>
    <div class="container">
        <div class="table-container">
            <h2>Daftar Negara dan Jumlah Proxy</h2>
            <table id="resultTable" style="display:none;">
                <thead>
                    <tr>
                        <th>Kode Negara</th>
                        <th>Total Proxy</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="details-container" id="details" style="display:none;">
            <h2 id="countryName"></h2>
            <p><strong>Detail Proxy:</strong></p>
            <div id="proxyList"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/iso-3166-1/1.0.0/iso-3166-1.min.js"></script>
    <script>
        async function fetchProxies() {
            try {
                const response = await fetch('proxy_list.txt');
                if (!response.ok) {
                    throw new Error('Gagal memuat file proxy_list.txt');
                }

                const proxyData = await response.text();
                const lines = proxyData.trim().split('\n');
                const countryProxies = {};
                const countryCount = {};

                lines.forEach(line => {
                    const [ip, port, country] = line.trim().split(',');

                    if (ip && port && country) {
                        const countryCode = country.toUpperCase();

                        // Menggunakan library iso-3166-1 untuk mendapatkan nama negara
                        const countryName = iso3166.getName(countryCode) || countryCode;

                        if (!countryProxies[countryCode]) {
                            countryProxies[countryCode] = [];
                        }
                        countryProxies[countryCode].push({ ip, port, country: countryName });
                        countryCount[countryCode] = (countryCount[countryCode] || 0) + 1;
                    }
                });

                const table = document.getElementById('resultTable');
                const tbody = table.querySelector('tbody');

                for (const [country, count] of Object.entries(countryCount)) {
                    const countryName = iso3166.getName(country) || country.toUpperCase();
                    const row = document.createElement('tr');
                    row.innerHTML = `<td><a href="#" onclick="showDetails('${country}')">${countryName}</a></td><td>${count}</td>`;
                    tbody.appendChild(row);
                }

                table.style.display = 'table';

                window.showDetails = function (country) {
                    const detailsDiv = document.getElementById('details');
                    const countryName = document.getElementById('countryName');
                    const proxyList = document.getElementById('proxyList');

                    countryName.textContent = iso3166.getName(country) || country.toUpperCase();
                    proxyList.innerHTML = '';

                    const proxies = countryProxies[country] || [];
                    proxies.forEach(proxy => {
                        const proxyDetail = `${proxy.ip}\n${proxy.port}\n${proxy.country}`;
                        const listItem = document.createElement('pre');
                        listItem.textContent = proxyDetail;
                        proxyList.appendChild(listItem);
                    });

                    detailsDiv.style.display = 'block';
                };
            } catch (error) {
                console.error(error);
                alert('Gagal memproses data: ' + error.message);
            }
        }

        fetchProxies();
    </script>
</body>
</html>
