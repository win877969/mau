<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #proxy-list {
            width: 100%;
            border-collapse: collapse;
        }
        #proxy-list td, #proxy-list th {
            border: 1px solid #ddd;
            padding: 8px;
        }
        #proxy-list th {
            background-color: #f2f2f2;
        }
        button {
            cursor: pointer;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
        }
        .active {
            font-weight: bold;
        }
        .search-container {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Proxy List</h1>

    <div class="search-container">
        <input type="text" id="search-bar" placeholder="Search for proxy...">
        <label for="items-per-page">Items per page: </label>
        <select id="items-per-page">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
        </select>
        <span id="total-proxy">Total Proxies: 0</span>
    </div>

    <table id="proxy-list-container">
        <thead>
            <tr>
                <th>Provider | Country</th>
                <th>Check Proxy</th>
                <th>Service Selector</th>
                <th>VLESS 443</th>
                <th>VLESS 80</th>
                <th>TROJAN</th>
                <th>SHADOWSOCK</th>
            </tr>
        </thead>
        <tbody id="proxy-list"></tbody>
    </table>

    <div id="pagination"></div>

    <script>
        let proxyPerPage = 10;
        let currentPage = 1;
        let filteredProxies = [];
        let allProxies = [];

        // Function to handle UUID generation
        function uuidv4() {
            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        }

        // Function to render proxies
        function renderProxies(proxies, proxyList, pagination) {
            const start = (currentPage - 1) * proxyPerPage;
            const end = start + proxyPerPage;
            const currentPageProxies = proxies.slice(start, end);

            proxyList.innerHTML = ''; // Clear previous list

            currentPageProxies.forEach(proxy => {
                const [ip, port, country, provider] = proxy.split(",");
                const uuid = uuidv4();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${provider} | ${country}</td>
                    <td><button class="cekproxy" onclick="checkProxyStatus('${ip}:${port}', this)">Check Proxy</button></td>
                    <td>
                        <select class="service-selector">
                            <option value="">NO WILDCARD</option>
                            <option value="ava.game.naver.com.tp1.bmkg.xyz">ava.game.naver.com</option>
                            <option value="graph.instagram.com.tp1.bmkg.xyz">graph.instagram.com</option>
                            <option value="quiz.int.vidio.com.tp1.bmkg.xyz">quiz.int.vidio.com</option>
                            <option value="live.iflix.com">live.iflix.com</option>
                            <option value="support.zoom.us.tp1.bmkg.xyz">support.zoom.us</option>
                            <option value="blog.webex.com.tp1.bmkg.xyz">blog.webex.com</option>
                            <option value="investors.spotify.com.tp1.bmkg.xyz">investors.spotify.com</option>
                            <option value="cache.netflix.com.tp1.bmkg.xyz">cache.netflix.com</option>
                            <option value="zaintest.vuclip.com.tp1.bmkg.xyz">zaintest.vuclip.com</option>
                            <option value="io.ruangguru.com.tp1.bmkg.xyz">io.ruangguru.com</option>
                            <option value="api.midtrans.com.tp1.bmkg.xyz">api.midtrans.com</option>
                        </select>
                    </td>
                    <td><button class="copy-vless">Copy VLESS 443</button></td>
                    <td><button class="copy-vless1">Copy VLESS 80</button></td>
                    <td><button class="copy-trojan">Copy TROJAN</button></td>
                    <td><button class="copy-ss">Copy SHADOWSOCK</button></td>
                `;
                proxyList.appendChild(row);
            });

            // Display total proxies
            const totalProxies = proxies.length;
            const totalProxyElement = document.getElementById('total-proxy');
            if (totalProxyElement) {
                totalProxyElement.textContent = `Total Proxies: ${totalProxies}`;
            }

            renderPagination(proxies, pagination);
        }

        // Function to render pagination
        function renderPagination(proxies, pagination) {
            const totalPages = Math.ceil(proxies.length / proxyPerPage);
            const maxButtons = 5;
            pagination.innerHTML = '';

            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.textContent = '<< Previous';
                prevButton.addEventListener('click', () => updatePage(currentPage - 1, proxies, pagination));
                pagination.appendChild(prevButton);
            }

            const startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            const endPage = Math.min(totalPages, startPage + maxButtons - 1);

            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                if (i === currentPage) {
                    pageButton.classList.add('active');
                }
                pageButton.addEventListener('click', () => updatePage(i, proxies, pagination));
                pagination.appendChild(pageButton);
            }

            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next >>';
                nextButton.addEventListener('click', () => updatePage(currentPage + 1, proxies, pagination));
                pagination.appendChild(nextButton);
            }
        }

        // Function to update page
        function updatePage(page, proxies, pagination) {
            currentPage = page;
            const proxyList = document.getElementById('proxy-list');
            renderProxies(proxies, proxyList, pagination);
        }

        // Function to filter proxies
        function filterProxies(searchTerm) {
            searchTerm = searchTerm.toLowerCase();
            filteredProxies = allProxies.filter(proxy => proxy.toLowerCase().includes(searchTerm));
            currentPage = 1;
            const proxyList = document.getElementById('proxy-list');
            const pagination = document.getElementById('pagination');
            renderProxies(filteredProxies, proxyList, pagination);
        }

        // Event listener for search bar
        document.getElementById('search-bar').addEventListener('input', (e) => {
            filterProxies(e.target.value);
        });

        // Event listener for items per page dropdown
        document.getElementById('items-per-page').addEventListener('change', (e) => {
            proxyPerPage = parseInt(e.target.value);
            const proxyList = document.getElementById('proxy-list');
            const pagination = document.getElementById('pagination');
            renderProxies(filteredProxies, proxyList, pagination);
        });

        // Fetching proxy data
        fetch("proxy_list.txt")
            .then(response => response.text())
            .then(data => {
                allProxies = data.split("\n").filter(line => line.trim() !== "");
                filteredProxies = allProxies;
                const proxyList = document.getElementById('proxy-list');
                const pagination = document.getElementById('pagination');
                renderProxies(filteredProxies, proxyList, pagination);
            })
            .catch(error => console.error("Error fetching proxy data:", error));

        // Check Proxy status function
        function checkProxyStatus(proxy, button) {
            button.textContent = 'Loading';
            button.style.backgroundColor = 'yellow'; // Set background color to yellow when loading
            button.style.color = 'black'; // Set text color to black during loading

            const startTime = performance.now();
            fetch('https://httpbin.org/ip', {
                method: 'GET',
                headers: {
                    'Proxy': `http://${proxy}`,
                },
                timeout: 5000
            })
                .then(response => {
                    const endTime = performance.now();
                    const latency = (endTime - startTime).toFixed(2);

                    if (response.ok) {
                        button.textContent = 'Working';
                        button.style.backgroundColor = 'green'; // Set background color to green if the proxy is working
                        button.style.color = 'white'; // Set text color to white for active proxy
                    } else {
                        throw new Error('Not working');
                    }
                })
                .catch(() => {
                    button.textContent = 'Failed';
                    button.style.backgroundColor = 'red'; // Set background color to red if the proxy failed
                    button.style.color = 'white'; // Set text color to white for failed proxy
                });
        }
    </script>
</body>
</html>
